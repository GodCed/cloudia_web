\href{https://npmjs.org/package/proxy-addr}{\tt !\mbox{[}N\+P\+M Version\mbox{]}\mbox{[}npm-\/image\mbox{]}} \href{https://npmjs.org/package/proxy-addr}{\tt !\mbox{[}N\+P\+M Downloads\mbox{]}\mbox{[}downloads-\/image\mbox{]}} \href{http://nodejs.org/download/}{\tt !\mbox{[}Node.\+js Version\mbox{]}\mbox{[}node-\/version-\/image\mbox{]}} \href{https://travis-ci.org/jshttp/proxy-addr}{\tt !\mbox{[}Build Status\mbox{]}\mbox{[}travis-\/image\mbox{]}} \href{https://coveralls.io/r/jshttp/proxy-addr?branch=master}{\tt !\mbox{[}Test Coverage\mbox{]}\mbox{[}coveralls-\/image\mbox{]}}

Determine address of proxied request

\subsection*{Install}


\begin{DoxyCode}
1 $ npm install proxy-addr
\end{DoxyCode}


\subsection*{A\+P\+I}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} proxyaddr = require(\textcolor{stringliteral}{'proxy-addr'})
\end{DoxyCode}


\subsubsection*{proxyaddr(req, trust)}

Return the address of the request, using the given {\ttfamily trust} parameter.

The {\ttfamily trust} argument is a function that returns {\ttfamily true} if you trust the address, {\ttfamily false} if you don\textquotesingle{}t. The closest untrusted address is returned.


\begin{DoxyCode}
proxyaddr(req, \textcolor{keyword}{function}(addr)\{ \textcolor{keywordflow}{return} addr === \textcolor{stringliteral}{'127.0.0.1'} \})
proxyaddr(req, \textcolor{keyword}{function}(addr, \hyperlink{058__bracket__recursion_8tcl_a8c90afd4641b25be86bd09983c3cbee0}{i})\{ \textcolor{keywordflow}{return} \hyperlink{058__bracket__recursion_8tcl_a8c90afd4641b25be86bd09983c3cbee0}{i} < 1 \})
\end{DoxyCode}


The {\ttfamily trust} arugment may also be a single I\+P address string or an array of trusted addresses, as plain I\+P addresses, C\+I\+D\+R-\/formatted strings, or I\+P/netmask strings.


\begin{DoxyCode}
proxyaddr(req, \textcolor{stringliteral}{'127.0.0.1'})
proxyaddr(req, ['127.0.0.0/8', '10.0.0.0/8'])
proxyaddr(req, ['127.0.0.0/255.0.0.0', '192.168.0.0/255.255.0.0'])
\end{DoxyCode}


This module also supports I\+Pv6. Your I\+Pv6 addresses will be normalized automatically (i.\+e. {\ttfamily fe80\+:\+:00ed\+:1} equals {\ttfamily fe80\+:0\+:0\+:0\+:0\+:0\+:ed\+:1}).


\begin{DoxyCode}
proxyaddr(req, \textcolor{stringliteral}{'::1'})
proxyaddr(req, ['::1/128', 'fe80::/10'])
proxyaddr(req, ['fe80::/ffc0::'])
\end{DoxyCode}


This module will automatically work with I\+Pv4-\/mapped I\+Pv6 addresses as well to support node.\+js in I\+Pv6-\/only mode. This means that you do not have to specify both {\ttfamily \+::ffff\+:a00\+:1} and {\ttfamily 10.\+0.\+0.\+1}.

As a convenience, this module also takes certain pre-\/defined names in addition to I\+P addresses, which expand into I\+P addresses\+:


\begin{DoxyCode}
proxyaddr(req, \textcolor{stringliteral}{'loopback'})
proxyaddr(req, ['loopback', 'fc00:ac:1ab5:fff::1/64'])
\end{DoxyCode}



\begin{DoxyItemize}
\item {\ttfamily loopback}\+: I\+Pv4 and I\+Pv6 loopback addresses (like {\ttfamily \+:\+:1} and {\ttfamily 127.\+0.\+0.\+1}).
\item {\ttfamily linklocal}\+: I\+Pv4 and I\+Pv6 link-\/local addresses (like {\ttfamily fe80\+:\+:1\+:1\+:1\+:1} and {\ttfamily 169.\+254.\+0.\+1}).
\item {\ttfamily uniquelocal}\+: I\+Pv4 private addresses and I\+Pv6 unique-\/local addresses (like {\ttfamily fc00\+:ac\+:1ab5\+:fff\+:\+:1} and {\ttfamily 192.\+168.\+0.\+1}).
\end{DoxyItemize}

When {\ttfamily trust} is specified as a function, it will be called for each address to determine if it is a trusted address. The function is given two arguments\+: {\ttfamily addr} and {\ttfamily i}, where {\ttfamily addr} is a string of the address to check and {\ttfamily i} is a number that represents the distance from the socket address.

\subsubsection*{proxyaddr.\+all(req, \mbox{[}trust\mbox{]})}

Return all the addresses of the request, optionally stopping at the first untrusted. This array is ordered from closest to furthest (i.\+e. {\ttfamily arr\mbox{[}0\mbox{]} === req.\+connection.\+remote\+Address}).


\begin{DoxyCode}
proxyaddr.all(req)
\end{DoxyCode}


The optional {\ttfamily trust} argument takes the same arguments as {\ttfamily trust} does in {\ttfamily proxyaddr(req, trust)}.


\begin{DoxyCode}
proxyaddr.all(req, \textcolor{stringliteral}{'loopback'})
\end{DoxyCode}


\subsubsection*{proxyaddr.\+compile(val)}

Compiles argument {\ttfamily val} into a {\ttfamily trust} function. This function takes the same arguments as {\ttfamily trust} does in {\ttfamily proxyaddr(req, trust)} and returns a function suitable for {\ttfamily proxyaddr(req, trust)}.


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} trust = proxyaddr.compile(\textcolor{stringliteral}{'localhost'})
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} addr  = proxyaddr(req, trust)
\end{DoxyCode}


This function is meant to be optimized for use against every request. It is recommend to compile a trust function up-\/front for the trusted configuration and pass that to {\ttfamily proxyaddr(req, trust)} for each request.

\subsection*{Testing}


\begin{DoxyCode}
1 $ npm test
\end{DoxyCode}


\subsection*{Benchmarks}


\begin{DoxyCode}
1 $ npm run-script bench
\end{DoxyCode}


\subsection*{License}

\mbox{[}M\+I\+T\mbox{]}(L\+I\+C\+E\+N\+S\+E) 