\href{https://npmjs.org/package/finalhandler}{\tt !\mbox{[}N\+P\+M Version\mbox{]}\mbox{[}npm-\/image\mbox{]}} \href{https://npmjs.org/package/finalhandler}{\tt !\mbox{[}N\+P\+M Downloads\mbox{]}\mbox{[}downloads-\/image\mbox{]}} \href{http://nodejs.org/download/}{\tt !\mbox{[}Node.\+js Version\mbox{]}\mbox{[}node-\/image\mbox{]}} \href{https://travis-ci.org/pillarjs/finalhandler}{\tt !\mbox{[}Build Status\mbox{]}\mbox{[}travis-\/image\mbox{]}} \href{https://coveralls.io/r/pillarjs/finalhandler?branch=master}{\tt !\mbox{[}Test Coverage\mbox{]}\mbox{[}coveralls-\/image\mbox{]}}

Node.\+js function to invoke as the final step to respond to H\+T\+T\+P request.

\subsection*{Installation}


\begin{DoxyCode}
1 $ npm install finalhandler
\end{DoxyCode}


\subsection*{A\+P\+I}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} finalhandler = require(\textcolor{stringliteral}{'finalhandler'})
\end{DoxyCode}


\subsubsection*{finalhandler(req, res, \mbox{[}options\mbox{]})}

Returns function to be invoked as the final step for the given {\ttfamily req} and {\ttfamily res}. This function is to be invoked as {\ttfamily fn(err)}. If {\ttfamily err} is falsy, the handler will write out a 404 response to the {\ttfamily res}. If it is truthy, an error response will be written out to the {\ttfamily res}, and {\ttfamily res.\+status\+Code} is set from {\ttfamily err.\+status}.

The final handler will also unpipe anything from {\ttfamily req} when it is invoked.

\paragraph*{options.\+env}

By default, the environment is determined by {\ttfamily N\+O\+D\+E\+\_\+\+E\+N\+V} variable, but it can be overridden by this option.

\paragraph*{options.\+onerror}

Provide a function to be called with the {\ttfamily err} when it exists. Can be used for writing errors to a central location without excessive function generation. Called as {\ttfamily onerror(err, req, res)}.

\subsection*{Examples}

\subsubsection*{always 404}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} finalhandler = require(\textcolor{stringliteral}{'finalhandler'})
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} http = require('http')

\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} server = http.createServer(\hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (req, res) \{
  \hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} done = finalhandler(req, res)
  done()
\})

server.listen(3000)
\end{DoxyCode}


\subsubsection*{perform simple action}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} finalhandler = require(\textcolor{stringliteral}{'finalhandler'})
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} fs = require('fs')
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} http = require('http')

\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} server = http.createServer(\hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (req, res) \{
  \hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} done = finalhandler(req, res)

  fs.readFile('index.html', \hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (err, buf) \{
    \textcolor{keywordflow}{if} (err) \textcolor{keywordflow}{return} done(err)
    res.setHeader('Content-Type', 'text/html')
    res.end(buf)
  \})
\})

server.listen(3000)
\end{DoxyCode}


\subsubsection*{use with middleware-\/style functions}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} finalhandler = require(\textcolor{stringliteral}{'finalhandler'})
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} http = require('http')
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} serveStatic = require('serve-static')

\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} serve = serveStatic('public')

\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} server = http.createServer(\hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (req, res) \{
  \hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} done = finalhandler(req, res)
  serve(req, res, done)
\})

server.listen(3000)
\end{DoxyCode}


\subsubsection*{keep log of all errors}


\begin{DoxyCode}
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} finalhandler = require(\textcolor{stringliteral}{'finalhandler'})
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} fs = require('fs')
\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} http = require('http')

\hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} server = http.createServer(\hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (req, res) \{
  \hyperlink{018__def_8c_a335628f2e9085305224b4f9cc6e95ed5}{var} done = finalhandler(req, res, \{onerror: logerror\})

  fs.readFile(\textcolor{stringliteral}{'index.html'}, \hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} (err, buf) \{
    \textcolor{keywordflow}{if} (err) \textcolor{keywordflow}{return} done(err)
    res.setHeader(\textcolor{stringliteral}{'Content-Type'}, \textcolor{stringliteral}{'text/html'})
    res.end(buf)
  \})
\})

server.listen(3000)

\hyperlink{class_test_a51a683fa4fcec142ab1574e00a7b6860}{function} logerror(err) \{
  console.error(err.stack || err.toString())
\}
\end{DoxyCode}


\subsection*{License}

\mbox{[}M\+I\+T\mbox{]}(L\+I\+C\+E\+N\+S\+E) 